
jobs:
  build-and-test: 
    docker:
      - image: cimg/python:3.10.2
    
    parameters:
      env:
        type: string
        default: ""

    steps:
      - checkout
      - run:
          name: run tests
          no_output_timeout: 30m
          command: |
            echo "tests ########"
            echo << parameters.env >>
            cd tests
            python -m venv venv
            . venv/bin/activate
            python -m pip install --upgrade pip
            pip install wheel
            pip install -r requirements.txt
            pytest -v -s


workflows:
  version: 2

  build-deploy:
    when:
      equal: [ "every_min", << pipeline.schedule.name >> ]
    jobs:
      - build-and-test


  # commit:
  #   jobs:
  #     - build-and-test:
  #         env: "dev"



  # my_workflow: 
  #   triggers:
  #     - schedule:
  #         cron: "*/5 * * * *"
    # when:
    #   equal: [ "every_min", << pipeline.schedule.name >> ]
    # jobs:
    #   - build-and-test
